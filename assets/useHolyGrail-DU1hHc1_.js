import{r as c}from"./vendor-react-Y6pfRwed.js";import{u as d}from"./index-DLbt949C.js";function w(){const{user:o,isLoading:s}=d(),[g,i]=c.useState(!1),u=e=>e?`d2r_grail_${e}`:"d2r_holy_grail_found",[n,a]=c.useState(()=>{try{const e=localStorage.getItem("d2r_holy_grail_found");return e?new Set(JSON.parse(e)):new Set}catch{return new Set}});return c.useEffect(()=>{if(s)return;const e=u(o?.id),r=localStorage.getItem(e);if(r)try{a(new Set(JSON.parse(r)))}catch(t){console.error("Failed to parse stored grail data",t)}else if(o?.id){const t=localStorage.getItem("d2r_holy_grail_found");if(t){console.log("Migrating guest data to user account...");try{const l=JSON.parse(t);a(new Set(l))}catch{}}else a(new Set)}},[o,s]),c.useEffect(()=>{if(s)return;const e=u(o?.id);try{localStorage.setItem(e,JSON.stringify(Array.from(n)))}catch(r){console.error("Failed to save Holy Grail data",r)}},[n,o,s]),c.useEffect(()=>{if(!o||s)return;(async()=>{i(!0);try{await new Promise(r=>setTimeout(r,800))}finally{i(!1)}})()},[o,s]),{foundItems:n,toggleItem:e=>{e&&a(r=>{const t=new Set(r);return t.has(e)?t.delete(e):t.add(e),t})},isFound:e=>n.has(e),resetProgress:()=>{confirm("Are you sure you want to reset your Holy Grail progress? This cannot be undone.")&&a(new Set)},totalFound:n.size,isSyncing:g}}export{w as u};
